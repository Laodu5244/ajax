<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>避免重复请求</title>
</head>

<body>
  <h3>避免重复请求</h3>
  <button id="btn">获取后台数据</button>
  <div class="content" id="content"></div>

  <script>
    function el(el) {
      return document.getElementById(el)
    }
    let btn = el('btn'), content = el('content');
    let xhr;
    let isLoading;

    btn.onclick = () => {
      if(isLoading){
        xhr.abort()
      }
      // 实例xhr
      xhr = new XMLHttpRequest()
      // 绑定监听
      xhr.onreadystatechange = () => {
        if (xhr.readyState === 4) {
          if (xhr.status >= 200 && xhr.status < 300) {
            isLoading = false
            const { name, age, sex } = xhr.response
            content.innerHTML = (`
            <ul>
              <li>姓名:${name}</li>
              <li>年龄:${age}</li>
              <li>性别:${sex}</li>
            </ul>`)
          }
        }
      }

      // 配置请求
      xhr.open('GET', 'http://127.0.0.1:3000/get3_delay')

      // responseType用于指定返回数据的格式
      xhr.responseType = 'json'

      // 发送请求
      xhr.send()
      isLoading = true
    }
  </script>

  <style>
    .content {
      width: 300px;
      height: 100px;
      border: 1px solid firebrick;
      margin-top: 20px;
    }
  </style>
</body>

</html>